"use strict";(self.webpackChunkng=self.webpackChunkng||[]).push([[3683],{53683:(Ce,U,a)=>{a.r(U),a.d(U,{TicketsModule:()=>ve});var c=a(69808),d=a(59516),u=a(4721),v=a(92340),p=a(40479),l=a(93075),g=a(41571),e=a(5e3),T=a(95625),m=a(9224),f=a(47423),h=a(25245),_=a(67322),x=a(77531),C=a(74107),b=a(90508),A=a(14623),M=a(29055),q=a(78536);function J(n,s){if(1&n&&(e.TgZ(0,"mat-option",23),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.id),e.xp6(1),e.Oqu(t.name)}}function I(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",9)(1,"div",24)(2,"button",25),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.removeImage())}),e.TgZ(3,"mat-icon"),e._uU(4,"close"),e.qZA()(),e._UZ(5,"img",26),e.qZA()()}if(2&n){const t=e.oxw();e.xp6(5),e.Q6J("src",t.fileUrl.url,e.LSH)}}function Q(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",27)(1,"div",15)(2,"label",28)(3,"mat-icon"),e._uU(4,"attach_file"),e.qZA(),e._uU(5," Adjuntar archivo "),e.qZA(),e.TgZ(6,"input",29),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onFileChange(o))}),e.qZA()(),e.TgZ(7,"button",30),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.saveInServer())}),e._uU(8,"Crear ticket "),e.TgZ(9,"mat-icon"),e._uU(10,"save"),e.qZA()()()}if(2&n){const t=e.oxw();e.xp6(7),e.Q6J("disabled",t.isLoading)}}function P(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"mat-list-item",31)(1,"div",32)(2,"span"),e._uU(3,"Cliente:"),e.qZA(),e._uU(4),e.qZA(),e.TgZ(5,"div",32)(6,"span"),e._uU(7,"Estado:"),e.qZA(),e._uU(8),e.ALo(9,"translatefz"),e.qZA(),e.TgZ(10,"div",32)(11,"span"),e._uU(12,"Total:"),e.qZA(),e._uU(13),e.qZA(),e.TgZ(14,"div",32)(15,"span"),e._uU(16,"Creado:"),e.qZA(),e._uU(17),e.ALo(18,"date"),e.qZA(),e.TgZ(19,"div",32)(20,"span"),e._uU(21,"# de orden:"),e.qZA(),e._uU(22),e.qZA(),e.TgZ(23,"div",32)(24,"button",33),e.NdJ("click",function(){const r=e.CHM(t).$implicit,xe=e.oxw();return e.KtG(xe.getOrder(r.id))}),e._uU(25,"Seleccionar"),e.qZA()()()}if(2&n){const t=s.$implicit;e.xp6(4),e.AsE(" ",t.client.first_name," ",t.client.last_name,""),e.xp6(4),e.hij(" ",e.xi3(9,6,t.status,"orders"),""),e.xp6(5),e.hij(" $",t.total,""),e.xp6(4),e.hij(" ",e.lcZ(18,9,t.created_at),""),e.xp6(5),e.hij(" ",t.id,"")}}const N=function(n){return{"search-orders-container-close":n}};let F=(()=>{class n{constructor(t,i,o){this.router=t,this.methodsHttp=i,this.activatedRoute=o,this.departments=[],this.form=new l.cw({order_id:new l.NI("",[l.kI.required]),department_id:new l.NI(null,[l.kI.required]),subject:new l.NI(null,[l.kI.required]),message:new l.NI(null,[l.kI.required]),file:new l.NI(null)}),this.fileUrl={url:null},this.isLoading=!1,this.urlOrders="system-orders/orders",this.orders=[],this.isOpenSearchOrder=!1,this.permissions=p.v_}ngOnInit(){this.methodsHttp.methodGet("system-orders/tickets/create").subscribe(t=>{this.departments=t.data.departments}),this.getOrderId()}getOrderId(){var t;console.log(g.F.getQueryParametersUrl("order_id",this.activatedRoute));const i=g.F.getQueryParametersUrl("order_id",this.activatedRoute);i&&(null===(t=this.form.get("order_id"))||void 0===t||t.setValue(i))}getDataOrder(t){console.log(t),this.orders=t.data}getOrder(t){var i;null===(i=this.form.get("order_id"))||void 0===i||i.setValue(t),this.isOpenSearchOrder=!1}onFileChange(t){g.F.getBase64(t,i=>{this.fileUrl.url=i.srcElement.result})}removeImage(){var t;this.fileUrl.url=null,null===(t=this.form.get("file"))||void 0===t||t.setValue(null)}saveInServer(){var t,i;if(this.form.valid){this.isLoading=!0;const o=new FormData;o.append("order_id",this.form.value.order_id),o.append("department_id",this.form.value.department_id),o.append("subject",this.form.value.subject),o.append("message",this.form.value.message),!(null===(t=this.form.get("file"))||void 0===t)&&t.value&&o.append("file",null===(i=this.form.get("file"))||void 0===i?void 0:i.value),this.methodsHttp.methodPost("system-orders/tickets",o).subscribe(r=>{console.log(r),this.isLoading=!1,this.router.navigate(["/system-orders/tickets"])},()=>{this.isLoading=!1})}else console.log("Formulario invalido"),this.form.markAllAsTouched()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(d.F0),e.Y36(T.s),e.Y36(d.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],decls:32,vars:10,consts:[[1,"my-3"],[1,"card-body"],[1,"row",3,"formGroup"],[1,"col-md-6"],["formControlName","department_id","placeholder","Seleccione un departamento"],[3,"value",4,"ngFor","ngForOf"],["matInput","","formControlName","order_id"],["matPrefix","",1,"text-muted","mr-2"],["type","button","mat-button","","matSuffix","",3,"click"],[1,"col-12"],["matInput","","formControlName","subject","placeholder","Asunto"],["matInput","","formControlName","message","placeholder","Mensaje"],["class","col-12",4,"ngIf"],["class","center",4,"ngxPermissionsOnly"],[1,"search-orders-container",3,"ngClass"],[1,"position-relative"],["mat-icon-button","",1,"btn-close",3,"click"],["color","warn"],[1,"container"],[3,"placeholder","url","data"],["data",""],[1,"row","d-flex","m-0"],["class","col-md-6 bg-white p-2 shadow",4,"ngFor","ngForOf"],[3,"value"],[1,"position-relative",2,"width","200px"],["mat-mini-fab","",1,"btn-remove-img",3,"click"],["alt","",1,"rounded-fz","shadow","w-100",3,"src"],[1,"center"],["for","file",1,"file-img","bg-orange","center","mr-1","mt-2","px-3","rounded-fz"],["formControlName","file","type","file","id","file","name","file",1,"d-none",3,"change"],["mat-raised-button","","color","primary",3,"disabled","click"],[1,"col-md-6","bg-white","p-2","shadow"],["matLine",""],["mat-button","","color","primary",3,"click"]],template:function(t,i){1&t&&(e.TgZ(0,"div")(1,"h1",0),e._uU(2,"Creador de Ticket"),e.qZA(),e.TgZ(3,"mat-card")(4,"div",1)(5,"div",2)(6,"mat-form-field",3)(7,"mat-select",4),e.YNc(8,J,2,2,"mat-option",5),e.qZA()(),e.TgZ(9,"mat-form-field",3),e._UZ(10,"input",6),e.TgZ(11,"span",7),e._uU(12,"Orden #"),e.qZA(),e.TgZ(13,"button",8),e.NdJ("click",function(){return i.isOpenSearchOrder=!i.isOpenSearchOrder}),e.TgZ(14,"mat-icon"),e._uU(15,"search"),e.qZA()()(),e.TgZ(16,"mat-form-field",9),e._UZ(17,"input",10),e.qZA(),e.TgZ(18,"mat-form-field",9),e._UZ(19,"textarea",11),e.qZA(),e.YNc(20,I,6,1,"div",12),e.YNc(21,Q,11,1,"div",13),e.qZA()()(),e.TgZ(22,"div",14)(23,"div",15)(24,"button",16),e.NdJ("click",function(){return i.isOpenSearchOrder=!i.isOpenSearchOrder}),e.TgZ(25,"mat-icon",17),e._uU(26,"close"),e.qZA()(),e.TgZ(27,"div",18)(28,"app-search",19),e.NdJ("data",function(r){return i.getDataOrder(r)}),e.ynx(29,20),e.TgZ(30,"mat-list",21),e.YNc(31,P,26,11,"mat-list-item",22),e.qZA(),e.BQk(),e.qZA()()()()()),2&t&&(e.xp6(5),e.Q6J("formGroup",i.form),e.xp6(3),e.Q6J("ngForOf",i.departments),e.xp6(12),e.Q6J("ngIf",i.fileUrl.url),e.xp6(1),e.Q6J("ngxPermissionsOnly",i.permissions.create),e.xp6(1),e.Q6J("ngClass",e.VKq(8,N,!i.isOpenSearchOrder)),e.xp6(6),e.Q6J("placeholder","Buscador de ordenes por cliente")("url",i.urlOrders),e.xp6(3),e.Q6J("ngForOf",i.orders))},dependencies:[c.mk,c.sg,c.O5,m.a8,f.lW,h.Hw,_.KE,_.qo,_.R9,x.Nt,C.gD,b.ey,A.i$,A.Tg,b.X2,l.Fj,l.JJ,l.JL,l.sg,l.u,M.g,u.gE,c.uU,q.P],styles:[".file-img[_ngcontent-%COMP%]{box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f;line-height:36px;cursor:pointer}.btn-remove-img[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;cursor:pointer}.search-orders-container[_ngcontent-%COMP%]{transform:translate(0);position:fixed;left:0;top:0;width:100%;height:100vh;transition:all .3s ease-in-out;z-index:1021;background:rgba(255,255,255,.5215686275);-webkit-backdrop-filter:blur(8px);backdrop-filter:blur(8px);overflow:auto}.search-orders-container-close[_ngcontent-%COMP%]{transform:translate(-100%)!important;transition:all .3s ease-in-out}"]}),n})();const R=["contentMessage"];function E(n,s){if(1&n&&(e.ynx(0),e.TgZ(1,"a",17),e._UZ(2,"img",18),e.qZA(),e.BQk()),2&n){const t=e.oxw(2).$implicit;e.xp6(1),e.Q6J("href",t.attachments[0].permalink,e.LSH),e.xp6(1),e.Q6J("src",t.attachments[0].permalink,e.LSH)}}function H(n,s){if(1&n&&(e.TgZ(0,"a",17)(1,"div",19)(2,"div",20)(3,"mat-icon",20),e._uU(4,"insert_drive_file"),e.qZA(),e.TgZ(5,"div"),e._uU(6,"Archivo"),e.qZA(),e.TgZ(7,"div",21),e._uU(8),e.qZA()()()()),2&n){const t=e.oxw(2).$implicit;e.Q6J("href",t.attachments[0].permalink,e.LSH),e.xp6(8),e.Oqu(t.attachments[0].name)}}function L(n,s){if(1&n&&(e.TgZ(0,"div",14),e.YNc(1,E,3,2,"ng-container",15),e.YNc(2,H,9,2,"ng-template",null,16,e.W1O),e.qZA()),2&n){const t=e.MAs(3),i=e.oxw().$implicit;e.Q6J("ngClass",i.is_staff_message?"justify-content-start":"justify-content-end"),e.xp6(1),e.Q6J("ngIf","image"===i.attachments[0].type)("ngIfElse",t)}}function j(n,s){if(1&n&&(e.TgZ(0,"span",22),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.Q6J("ngClass",t.client_read_at?"bg-green-400":"bg-red-400"),e.xp6(1),e.Oqu(t.client_read_at?"Le\xeddo":"Sin leer")}}function Y(n,s){if(1&n&&(e.TgZ(0,"small",23),e._uU(1),e.qZA()),2&n){const t=e.oxw().$implicit;e.xp6(1),e.hij("Por: ",t.user.name,"")}}function D(n,s){if(1&n&&(e.TgZ(0,"div",7)(1,"div",8),e.YNc(2,L,4,3,"div",9),e.TgZ(3,"span",10),e._uU(4),e._UZ(5,"br"),e.qZA(),e.TgZ(6,"small",11),e._uU(7),e.ALo(8,"date"),e.YNc(9,j,2,2,"span",12),e.qZA(),e.YNc(10,Y,2,1,"small",13),e.qZA()()),2&n){const t=s.$implicit;e.Q6J("ngClass",t.is_staff_message?"message-received":"message-send"),e.xp6(2),e.Q6J("ngIf",t.attachments&&t.attachments.length>0),e.xp6(2),e.hij("",t.message," "),e.xp6(3),e.hij(" ",e.lcZ(8,6,t.created_at)," "),e.xp6(2),e.Q6J("ngIf",t.is_staff_message),e.xp6(1),e.Q6J("ngIf",t.is_staff_message)}}let O=(()=>{class n{constructor(t,i){this.methodsHttp=t,this.activatedRouter=i,this.messages=[],this.ticket_id=null}ngOnInit(){this.ticket_id=g.F.getParametersUrl("id",this.activatedRouter),this.getMessages()}getMessages(){this.methodsHttp.methodGet(`system-orders/tickets/${this.ticket_id}/messages`).subscribe(t=>{this.messages=t.data.reverse(),this.markAsRead(),setTimeout(()=>{this.contentMessage.nativeElement.scrollTop=this.contentMessage.nativeElement.scrollHeight},1e3)})}markAsRead(){this.methodsHttp.methodPut(`system-orders/tickets/${this.ticket_id}/messages/mark-as-read`).subscribe(t=>{console.log(t)})}addMessage(t){this.messages.push(t)}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.s),e.Y36(d.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-chat-ticket"]],viewQuery:function(t,i){if(1&t&&e.Gf(R,5),2&t){let o;e.iGM(o=e.CRH())&&(i.contentMessage=o.first)}},decls:12,vars:2,consts:[[1,"mb-3"],[1,"d-flex","justify-content-between","flex-wrap","align-items-center"],[1,"font-2xl","m-0"],["color","info","mat-raised-button","",3,"click"],[1,"content-messages","mt-3","mb-2","p-3","block","bg-white","rounded-fz","shadow-sm","min-h-10",3,"scrollTop"],["contentMessage",""],[3,"ngClass",4,"ngFor","ngForOf"],[3,"ngClass"],[1,"message-container"],["class","d-flex  mb-1",3,"ngClass",4,"ngIf"],[1,"message"],[1,"block"],["class","text-white rounded px-2",3,"ngClass",4,"ngIf"],["class","text-black-50",4,"ngIf"],[1,"d-flex","mb-1",3,"ngClass"],[4,"ngIf","ngIfElse"],["templateFile",""],["target","_blank",3,"href"],["alt","",1,"rounded-fz","shadow","w-100",3,"src"],[1,"bg-dark","rounded-fz","shadow","center",2,"height","150px","width","100px"],[1,"text-center"],[1,"text-muted"],[1,"text-white","rounded","px-2",3,"ngClass"],[1,"text-black-50"]],template:function(t,i){if(1&t&&(e.TgZ(0,"div")(1,"mat-card",0)(2,"div",1)(3,"h3",2),e._uU(4,"Mensajes"),e.qZA(),e.TgZ(5,"button",3),e.NdJ("click",function(){return i.getMessages()}),e.TgZ(6,"mat-icon"),e._uU(7,"refresh"),e.qZA(),e._uU(8," Actualizar"),e.qZA()(),e.TgZ(9,"div",4,5),e.YNc(11,D,11,8,"div",6),e.qZA()()()),2&t){const o=e.MAs(10);e.xp6(9),e.Q6J("scrollTop",o.scrollHeight),e.xp6(2),e.Q6J("ngForOf",i.messages)}},dependencies:[c.mk,c.sg,c.O5,m.a8,f.lW,h.Hw,c.uU],styles:[".message-received[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{background-color:#08a16e;color:#fff;max-width:80%}.message-send[_ngcontent-%COMP%]   .message[_ngcontent-%COMP%]{background-color:#232945;color:#fff}.message-send[_ngcontent-%COMP%]{display:flex;justify-content:flex-end}.message-send[_ngcontent-%COMP%]{text-align:right}.content-messages[_ngcontent-%COMP%]{min-height:200px;max-height:450px;overflow-y:auto}.message-container[_ngcontent-%COMP%]{width:80%;margin-bottom:.5rem}.message[_ngcontent-%COMP%]{border-radius:8px;padding:.25rem .6rem;display:inline-block;text-justify:auto;font-size:.875rem;line-height:1.25rem}.block[_ngcontent-%COMP%]{display:block}.bg-green-400[_ngcontent-%COMP%]{background-color:#08a16e}.bg-red-400[_ngcontent-%COMP%]{background-color:red}"]}),n})();var S=a(86405),k=a(26688);function $(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",18),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.closeTicket())}),e._uU(1,"Cerrar Ticket"),e.qZA()}}function z(n,s){if(1&n&&(e.ynx(0),e.YNc(1,$,2,0,"button",17),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf","open"===(null==t.ticket?null:t.ticket.status))}}function G(n,s){if(1&n&&(e.ynx(0),e._UZ(1,"img",23),e.BQk()),2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("src",t.fileUrl.url,e.LSH)}}function B(n,s){if(1&n&&(e.TgZ(0,"div",24)(1,"div",25)(2,"mat-icon",25),e._uU(3,"insert_drive_file"),e.qZA(),e.TgZ(4,"div"),e._uU(5,"Archivo"),e.qZA(),e.TgZ(6,"div",26),e._uU(7),e.qZA()()()),2&n){const t=e.oxw(2);e.xp6(7),e.Oqu(null==t.fileUrl.file?null:t.fileUrl.file.name)}}function K(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",13)(1,"div",19)(2,"button",20),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.removeImage())}),e.TgZ(3,"mat-icon"),e._uU(4,"close"),e.qZA()(),e.YNc(5,G,2,1,"ng-container",21),e.YNc(6,B,8,1,"ng-template",null,22,e.W1O),e.qZA()()}if(2&n){const t=e.MAs(7),i=e.oxw();e.xp6(5),e.Q6J("ngIf",null==i.fileUrl.file?null:i.fileUrl.file.type.includes("image"))("ngIfElse",t)}}function V(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"button",32),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.saveInServer())}),e._uU(1,"Enviar mensaje "),e.TgZ(2,"mat-icon"),e._uU(3,"send"),e.qZA()()}if(2&n){const t=e.oxw(2);e.Q6J("disabled",t.isLoading)}}function W(n,s){if(1&n){const t=e.EpF();e.TgZ(0,"div",27)(1,"div",28)(2,"label",29)(3,"mat-icon"),e._uU(4,"attach_file"),e.qZA(),e._uU(5," Adjuntar archivo "),e.qZA(),e.TgZ(6,"input",30),e.NdJ("change",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.onFileChange(o))}),e.qZA()(),e.YNc(7,V,4,1,"button",31),e.qZA()}if(2&n){const t=e.oxw();e.xp6(7),e.Q6J("ngxPermissionsOnly",t.permissions.edit)}}const X=function(){return["/system-orders/orders"]},ee=function(n){return{search:n}};let te=(()=>{class n{constructor(t,i,o,r){this.spinner=t,this.methodsHttp=i,this.router=o,this.activatedRouter=r,this.form=new l.cw({message:new l.NI("",[l.kI.required]),file:new l.NI(null)}),this.fileUrl={url:null,file:null},this.isLoading=!1,this.ticket=null,this.ticket_id=null,this.permissions=p.v_}ngOnInit(){this.spinner.show(),this.ticket_id=g.F.getParametersUrl("id",this.activatedRouter),this.markAsRead(),this.methodsHttp.methodGet(`system-orders/tickets/${this.ticket_id}`).subscribe(t=>{this.ticket=t.data,this.spinner.hide()},()=>{this.spinner.hide()})}markAsRead(){this.methodsHttp.methodPut(`system-orders/tickets/${this.ticket_id}/messages/mark-as-read`).subscribe(t=>{console.log(t)})}closeTicket(){g.F.swalResponse({title:"\xbfEst\xe1 seguro de cerrar el ticket?",text:"Una vez cerrado no podr\xe1 responder al mismo",icon:"warning",showCancelButton:!0,showConfirmButton:!0,confirmButtonText:"Si,Cerrar ticket",cancelButtonText:"No, Cancelar"},this.sendCloseTicket.bind(this))}sendCloseTicket(){this.methodsHttp.methodPut(`system-orders/tickets/${this.ticket_id}/close`).subscribe(()=>{this.router.navigate(["/system-orders/tickets"])})}onFileChange(t){g.F.getBase64(t,i=>{this.fileUrl.file=t.target.files[0],this.fileUrl.url=i.srcElement.result})}removeImage(){var t;this.fileUrl.url=null,this.fileUrl.file=null,null===(t=this.form.get("file"))||void 0===t||t.setValue(null)}saveInServer(){if(this.form.valid){this.isLoading=!0;const t=new FormData;t.append("message",this.form.value.message),this.fileUrl.file&&t.append("file",this.fileUrl.file),this.methodsHttp.methodPost(`system-orders/tickets/${this.ticket_id}/messages`,t).subscribe(i=>{console.log(i),this.isLoading=!1,this.chatComponent.addMessage(i.data),this.ticket&&(this.ticket.status="open"),this.form.reset()},()=>{this.isLoading=!1})}else console.log("Formulario invalido"),this.form.markAllAsTouched()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(S.t2),e.Y36(T.s),e.Y36(d.F0),e.Y36(d.gz))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(t,i){if(1&t&&e.Gf(O,5),2&t){let o;e.iGM(o=e.CRH())&&(i.chatComponent=o.first)}},decls:78,vars:29,consts:[[1,"mt-3"],[1,"my-2","d-flex","justify-content-between","flex-wrap","align-items-center"],["selected",""],[4,"ngxPermissionsOnly"],[1,"card-body"],[1,"row"],[1,"col-md-6"],[1,"mb-3"],[1,"font-2xl"],[1,"font-lg"],[1,"table","table-borderless","table-sm"],[1,"border-0",3,"routerLink","queryParams"],[3,"formGroup"],[1,"col-12"],["matInput","","formControlName","message","placeholder","Mensaje"],["class","col-12",4,"ngIf"],["class","center",4,"ngxPermissionsOnly"],["color","warn","mat-raised-button","",3,"click",4,"ngIf"],["color","warn","mat-raised-button","",3,"click"],[1,"position-relative",2,"width","200px"],["mat-mini-fab","",1,"btn-remove-img",3,"click"],[4,"ngIf","ngIfElse"],["templateFile",""],["alt","",1,"rounded-fz","shadow","w-100",3,"src"],[1,"bg-dark","rounded-fz","shadow","center",2,"height","250px"],[1,"text-center"],[1,"text-muted"],[1,"center"],[1,"position-relative"],["for","file",1,"file-img","bg-orange","center","mr-1","mt-2","px-3","rounded-fz"],["formControlName","file","type","file","id","file","name","file","accept","image/png,image/jpeg,application/pdf",1,"d-none",3,"change"],["mat-raised-button","","color","primary",3,"disabled","click",4,"ngxPermissionsOnly"],["mat-raised-button","","color","primary",3,"disabled","click"]],template:function(t,i){1&t&&(e.TgZ(0,"div")(1,"h1",0),e._uU(2),e.qZA(),e.TgZ(3,"div",1)(4,"mat-chip-list")(5,"mat-chip",2),e._uU(6),e.qZA()(),e.YNc(7,z,2,1,"ng-container",3),e.qZA(),e.TgZ(8,"h3"),e._uU(9),e.qZA(),e.TgZ(10,"mat-card")(11,"div",4)(12,"div",5)(13,"div",6)(14,"div")(15,"mat-card",7)(16,"h3",8),e._uU(17,"Cliente"),e.qZA(),e.TgZ(18,"p",9),e._uU(19),e.qZA(),e.TgZ(20,"table",10)(21,"tbody")(22,"tr")(23,"td"),e._uU(24,"Direcci\xf3n:"),e.qZA(),e.TgZ(25,"td"),e._uU(26),e.qZA()(),e.TgZ(27,"tr")(28,"td"),e._uU(29,"Documento:"),e.qZA(),e.TgZ(30,"td"),e._uU(31),e.qZA()(),e.TgZ(32,"tr")(33,"td"),e._uU(34,"Email:"),e.qZA(),e.TgZ(35,"td"),e._uU(36),e.qZA()(),e.TgZ(37,"tr")(38,"td"),e._uU(39,"Pa\xeds:"),e.qZA(),e.TgZ(40,"td"),e._uU(41),e.qZA()()()()(),e.TgZ(42,"mat-card",7)(43,"h3",8),e._uU(44,"Detalles"),e.qZA(),e.TgZ(45,"table",10)(46,"tbody")(47,"tr")(48,"td"),e._uU(49,"Departamento:"),e.qZA(),e.TgZ(50,"td"),e._uU(51),e.qZA()(),e.TgZ(52,"tr")(53,"td"),e._uU(54,"# Orden:"),e.qZA(),e.TgZ(55,"td")(56,"button",11),e._uU(57),e.qZA()()(),e.TgZ(58,"tr")(59,"td"),e._uU(60,"Creado:"),e.qZA(),e.TgZ(61,"td"),e._uU(62),e.ALo(63,"date"),e.qZA()(),e.TgZ(64,"tr")(65,"td"),e._uU(66,"Actualizado:"),e.qZA(),e.TgZ(67,"td"),e._uU(68),e.ALo(69,"date"),e.qZA()()()()(),e.TgZ(70,"mat-card")(71,"div",12)(72,"mat-form-field",13),e._UZ(73,"textarea",14),e.qZA(),e.YNc(74,K,8,2,"div",15),e.YNc(75,W,8,1,"div",16),e.qZA()()()(),e.TgZ(76,"div",6),e._UZ(77,"app-chat-ticket"),e.qZA()()()()()),2&t&&(e.xp6(2),e.hij("Ticket # ",null==i.ticket?null:i.ticket.code,""),e.xp6(3),e.Tol("open"===(null==i.ticket?null:i.ticket.status)?"bg-info":"bg-warning"),e.xp6(1),e.hij("Estado: ","open"===(null==i.ticket?null:i.ticket.status)?"Abierto":"Cerrado",""),e.xp6(1),e.Q6J("ngxPermissionsOnly",i.permissions.edit),e.xp6(2),e.Oqu(null==i.ticket?null:i.ticket.subject),e.xp6(10),e.AsE("",null==i.ticket||null==i.ticket.client?null:i.ticket.client.first_name," ",null==i.ticket||null==i.ticket.client?null:i.ticket.client.last_name,""),e.xp6(7),e.AsE("",null==i.ticket||null==i.ticket.client?null:i.ticket.client.country," ",null==i.ticket||null==i.ticket.client?null:i.ticket.client.state,""),e.xp6(5),e.Oqu(null==i.ticket||null==i.ticket.client?null:i.ticket.client.doc_id),e.xp6(5),e.Oqu(null==i.ticket||null==i.ticket.client?null:i.ticket.client.email),e.xp6(5),e.Oqu(null==i.ticket||null==i.ticket.client?null:i.ticket.client.phone),e.xp6(10),e.Oqu(null==i.ticket||null==i.ticket.department?null:i.ticket.department.name),e.xp6(5),e.Q6J("routerLink",e.DdM(26,X))("queryParams",e.VKq(27,ee,null==i.ticket?null:i.ticket.order_id)),e.xp6(1),e.Oqu(null==i.ticket?null:i.ticket.order_id),e.xp6(5),e.Oqu(e.lcZ(63,22,null==i.ticket?null:i.ticket.created_at)),e.xp6(6),e.Oqu(e.lcZ(69,24,null==i.ticket?null:i.ticket.updated_at)),e.xp6(3),e.Q6J("formGroup",i.form),e.xp6(3),e.Q6J("ngIf",i.fileUrl.url),e.xp6(1),e.Q6J("ngxPermissionsOnly",i.permissions.edit))},dependencies:[c.O5,d.rH,m.a8,k.qn,k.HS,f.lW,h.Hw,_.KE,x.Nt,l.Fj,l.JJ,l.JL,l.sg,l.u,u.gE,O,c.uU],styles:[".file-img[_ngcontent-%COMP%]{box-shadow:0 3px 1px -2px #0003,0 2px 2px #00000024,0 1px 5px #0000001f;line-height:36px;cursor:pointer}.btn-remove-img[_ngcontent-%COMP%]{position:absolute;top:10px;right:10px;cursor:pointer}table[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){color:#03a9f4}table[_ngcontent-%COMP%]{font-size:1rem!important}"]}),n})();var y=a(28300),Z=a(92181);const ne=function(n){return[n]};function ie(n,s){if(1&n&&(e.TgZ(0,"button",26),e._uU(1," Responder "),e.qZA()),2&n){const t=e.oxw().$implicit;e.Q6J("routerLink",e.VKq(1,ne,t.id))}}const oe=function(){return["/system-orders/orders"]},se=function(n){return{search:n}};function re(n,s){if(1&n&&(e.TgZ(0,"button",27),e._uU(1," Ver orden "),e.qZA()),2&n){const t=e.oxw().$implicit;e.Q6J("routerLink",e.DdM(2,oe))("queryParams",e.VKq(3,se,t.order_id))}}const ae=function(){return["/system-orders/tickets/create"]},le=function(n){return{order_id:n}};function ce(n,s){if(1&n&&(e.TgZ(0,"button",27),e._uU(1," Crear ticket "),e.qZA()),2&n){const t=e.oxw().$implicit;e.Q6J("routerLink",e.DdM(2,ae))("queryParams",e.VKq(3,le,t.order_id))}}const de=function(n){return{"bg-red text-white":n}};function me(n,s){if(1&n&&(e.TgZ(0,"mat-card",10)(1,"div")(2,"small",11),e._uU(3,"Cliente"),e.qZA()(),e.TgZ(4,"mat-card-header")(5,"mat-card-title"),e._uU(6),e.qZA(),e.TgZ(7,"mat-card-subtitle")(8,"div")(9,"small",12),e._uU(10,"Asunto"),e.qZA()(),e._uU(11),e.qZA()(),e.TgZ(12,"mat-card-content")(13,"div")(14,"span",13),e._uU(15,"N\xfamero: "),e.qZA(),e.TgZ(16,"span"),e._uU(17),e.qZA()(),e.TgZ(18,"div")(19,"span",13),e._uU(20,"Estado:"),e.qZA(),e.TgZ(21,"mat-chip",14),e._uU(22),e.qZA()(),e.TgZ(23,"div")(24,"table",15)(25,"tbody")(26,"tr")(27,"td"),e._uU(28,"Departamento:"),e.qZA(),e.TgZ(29,"td"),e._uU(30),e.qZA()(),e.TgZ(31,"tr")(32,"td"),e._uU(33,"# Orden:"),e.qZA(),e.TgZ(34,"td"),e._uU(35),e.qZA()(),e.TgZ(36,"tr")(37,"td"),e._uU(38,"Fecha de creaci\xf3n:"),e.qZA(),e.TgZ(39,"td"),e._uU(40),e.ALo(41,"date"),e.qZA()(),e.TgZ(42,"tr")(43,"td"),e._uU(44,"Mensajes sin leer:"),e.qZA(),e.TgZ(45,"td")(46,"span",16),e._uU(47),e.qZA()()()()(),e.TgZ(48,"div",17)(49,"h4",18),e._uU(50,"Ultimo mensaje:"),e.qZA(),e.TgZ(51,"p",19),e._uU(52),e.qZA()()()(),e.TgZ(53,"mat-card-actions",20)(54,"div",21),e.YNc(55,ie,2,3,"button",22),e.TgZ(56,"button",23)(57,"mat-icon"),e._uU(58,"more_vert"),e.qZA()()(),e.TgZ(59,"mat-menu",null,24),e.YNc(61,re,2,5,"button",25),e.YNc(62,ce,2,5,"button",25),e.qZA()()()),2&n){const t=s.$implicit,i=e.MAs(60),o=e.oxw();e.xp6(6),e.AsE("",t.client.first_name," ",t.client.last_name,""),e.xp6(5),e.hij(" ",t.subject,""),e.xp6(6),e.Oqu(t.code),e.xp6(4),e.Tol("open"===t.status?"bg-info":"bg-warning"),e.xp6(1),e.Oqu("open"===t.status?"Abierto":"Cerrado"),e.xp6(8),e.Oqu(null==t||null==t.department?null:t.department.name),e.xp6(5),e.Oqu(t.order.id),e.xp6(5),e.Oqu(e.lcZ(41,17,t.created_at)),e.xp6(6),e.Q6J("ngClass",e.VKq(19,de,t.user_unread_messages>0)),e.xp6(1),e.Oqu(t.user_unread_messages),e.xp6(5),e.Oqu(null==t||null==t.last_message?null:t.last_message.message),e.xp6(3),e.Q6J("ngxPermissionsOnly",o.permissions.edit),e.xp6(1),e.Q6J("matMenuTriggerFor",i),e.xp6(5),e.Q6J("ngxPermissionsOnly",o.permissionOrderIndex),e.xp6(1),e.Q6J("ngxPermissionsOnly",o.permissions.create)}}function ue(n,s){if(1&n&&(e.TgZ(0,"mat-option",32),e._uU(1),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij(" ",t.name," ")}}const pe=function(){return["create"]};function ge(n,s){if(1&n){const t=e.EpF();e.ynx(0,28),e.TgZ(1,"mat-chip-list",29)(2,"mat-chip")(3,"mat-select",30),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.workspaceSelect=o)})("selectionChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.changeWorkspaces(o))}),e.YNc(4,ue,2,2,"mat-option",9),e.qZA()(),e.TgZ(5,"mat-chip",31)(6,"mat-icon"),e._uU(7,"add"),e.qZA(),e._uU(8," Crear ticket"),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw();e.xp6(3),e.Q6J("ngModel",t.workspaceSelect),e.xp6(1),e.Q6J("ngForOf",t.workspaces),e.xp6(1),e.Q6J("routerLink",e.DdM(3,pe))}}function _e(n,s){if(1&n&&(e.TgZ(0,"mat-option",32),e._uU(1),e.ALo(2,"translatefz"),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t),e.xp6(1),e.hij("",e.lcZ(2,2,t)," ")}}function fe(n,s){if(1&n&&(e.TgZ(0,"mat-option",32),e._uU(1),e.ALo(2,"translatefz"),e.qZA()),2&n){const t=s.$implicit;e.Q6J("value",t.id),e.xp6(1),e.hij("",e.lcZ(2,2,t.name)," ")}}const he=[{path:"",component:(()=>{class n{constructor(t){this.methodsHttp=t,this.url="system-orders/tickets",this.workspaceSelect=null,this.tickets=[],this.filters={status:"open",ticket_department_id:null,order_id:null,client_id:null,client_unread_messages:null,user_unread_messages:null},this.statuses=[],this.departments=[],this.permissions=p.v_,this.permissionOrderIndex=p.Qy.index,this.workspaces=[]}ngOnInit(){this.getDataForFilter(),this.getMyWorkspacesOrder()}getDataForFilter(){this.methodsHttp.methodGet("system-orders/tickets/filter-data").subscribe(t=>{this.departments=t.data.departments,this.statuses=t.data.statuses,this.workspaceSelect=t.data.workspace_preference})}getData(t){console.log(t),this.tickets=t}changeWorkspaces(t){this.methodsHttp.methodPut(`system-orders/workspaces/preference/${t.value}`).subscribe({next:()=>{this.headerComponent.searchNow()}})}getMyWorkspacesOrder(){this.methodsHttp.methodGet("system-orders/workspaces/me").subscribe({next:t=>{this.workspaces=t.data}})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(T.s))},n.\u0275cmp=e.Xpm({type:n,selectors:[["ng-component"]],viewQuery:function(t,i){if(1&t&&e.Gf(y._,5),2&t){let o;e.iGM(o=e.CRH())&&(i.headerComponent=o.first)}},decls:22,vars:11,consts:[["placeholder","Buscar tickets","active_filters_menu","true",3,"title","url$","filter_data","data"],["data",""],["class","card border-0",4,"ngFor","ngForOf"],["menuBar","",4,"ngxPermissionsOnly"],["filterMenu",""],["mat-menu-item","",3,"disableRipple","click","keydown"],[1,"w-100"],[3,"ngModel","ngModelChange"],["value",""],[3,"value",4,"ngFor","ngForOf"],[1,"card","border-0"],[1,"px-3","text-muted"],[1,"text-muted"],[1,"mr-1"],["selected",""],[1,"table-ticket","table","table-borderless","table-sm"],[1,"badge","font-xs",3,"ngClass"],[1,"px-3","py-2","rounded-fz","shadow"],[1,"mt-2","mb-1","text-black-50"],[1,"message"],["align","start"],[1,"d-flex","justify-content-between"],["color","primary","routerLinkActive","router-link-active","mat-raised-button","",3,"routerLink",4,"ngxPermissionsOnly"],["mat-icon-button","",3,"matMenuTriggerFor"],["menuRef","matMenu"],["mat-menu-item","",3,"routerLink","queryParams",4,"ngxPermissionsOnly"],["color","primary","routerLinkActive","router-link-active","mat-raised-button","",3,"routerLink"],["mat-menu-item","",3,"routerLink","queryParams"],["menuBar",""],[1,"mx-1"],["placeholder","Espacio de trabajo",3,"ngModel","ngModelChange","selectionChange"],["color","orange",1,"ml-1","mat-btn-add",3,"routerLink"],[3,"value"]],template:function(t,i){1&t&&(e.TgZ(0,"div")(1,"app-search-template",0),e.NdJ("data",function(r){return i.getData(r)}),e.ynx(2,1),e.YNc(3,me,63,21,"mat-card",2),e.BQk(),e.YNc(4,ge,9,4,"ng-container",3),e.ynx(5,4),e.TgZ(6,"div",5),e.NdJ("click",function(r){return r.stopPropagation()})("keydown",function(r){return r.stopPropagation()}),e.TgZ(7,"mat-form-field",6)(8,"mat-label"),e._uU(9,"Estado"),e.qZA(),e.TgZ(10,"mat-select",7),e.NdJ("ngModelChange",function(r){return i.filters.status=r}),e.TgZ(11,"mat-option",8),e._uU(12,"Todos"),e.qZA(),e.YNc(13,_e,3,4,"mat-option",9),e.qZA()()(),e.TgZ(14,"div",5),e.NdJ("click",function(r){return r.stopPropagation()})("keydown",function(r){return r.stopPropagation()}),e.TgZ(15,"mat-form-field",6)(16,"mat-label"),e._uU(17,"Departamentos"),e.qZA(),e.TgZ(18,"mat-select",7),e.NdJ("ngModelChange",function(r){return i.filters.ticket_department_id=r}),e.TgZ(19,"mat-option",8),e._uU(20,"Todos"),e.qZA(),e.YNc(21,fe,3,4,"mat-option",9),e.qZA()()(),e.BQk(),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("title","Tickets")("url$",i.url)("filter_data",i.filters),e.xp6(2),e.Q6J("ngForOf",i.tickets),e.xp6(1),e.Q6J("ngxPermissionsOnly",i.permissions.create),e.xp6(2),e.Q6J("disableRipple",!0),e.xp6(4),e.Q6J("ngModel",i.filters.status),e.xp6(3),e.Q6J("ngForOf",i.statuses),e.xp6(1),e.Q6J("disableRipple",!0),e.xp6(4),e.Q6J("ngModel",i.filters.ticket_department_id),e.xp6(3),e.Q6J("ngForOf",i.departments))},dependencies:[c.mk,c.sg,d.rH,d.Od,y._,m.a8,m.dk,m.dn,m.n5,m.$j,m.hq,k.qn,k.HS,f.lW,h.Hw,_.KE,_.hX,C.gD,b.ey,l.JJ,Z.VK,Z.OP,Z.p6,l.On,u.gE,c.uU,q.P],styles:[".table-ticket[_ngcontent-%COMP%]   tbody[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(1){color:#202c72}.message[_ngcontent-%COMP%]{width:auto;overflow:hidden;line-height:1.3rem;height:2.7rem;-webkit-box-orient:vertical;display:block;display:-webkit-box;overflow:hidden!important;text-overflow:ellipsis;-webkit-line-clamp:2}"]}),n})(),data:{permissions:{only:p.v_.index,redirectTo:v.N.ERROR_403_REDIRECT_URL}},canActivate:[u.DD]},{path:"create",component:F,data:{permissions:{only:p.v_.create,redirectTo:v.N.ERROR_403_REDIRECT_URL}},canActivate:[u.DD]},{path:":id",component:te,data:{permissions:{only:p.v_.edit,redirectTo:v.N.ERROR_403_REDIRECT_URL}},canActivate:[u.DD]}];let ke=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[d.Bz.forChild(he),d.Bz]}),n})();var Te=a(75401),w=a(81974),Ze=a(82085);let ve=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[c.ez,ke,Te.r,m.QW,k.Hi,f.ot,h.Ps,_.lN,x.c,C.LD,A.ie,l.UX,Z.Tx,l.u5,w.F,Ze.v,w.F,u.VI]}),n})()}}]);